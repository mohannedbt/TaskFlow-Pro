@model TaskFlow_Pro.Models.ProfileViewModel
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    ViewData["Title"] = "My Profile";
    
    var teamSelectList = new SelectList(
        Model.AvailableTeams,
        "Id",
        "Name",
        Model.TeamId
    );
}

<style>
    .profile-container { color: var(--text-main); }
    
    .profile-card {
        background: var(--card-bg);
        border: 1px solid var(--sidebar-border);
        border-radius: 28px;
    }

    .avatar-border {
        border-color: var(--card-bg) !important;
        box-shadow: 0 0 0 4px var(--sidebar-border);
    }

    .theme-input-group .input-group-text {
        background-color: var(--nav-hover) !important;
        color: var(--text-muted);
        border: none;
        border-radius: 12px 0 0 12px;
    }

    .theme-input-group .form-control, 
    .theme-input-group .form-select {
        background-color: var(--nav-hover) !important;
        color: var(--text-main) !important;
        border: none;
        border-radius: 0 12px 12px 0;
    }

    .form-label-caps {
        font-size: 0.65rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
    }

    .x-small { font-size: 0.75rem; display: block; margin-top: 4px; }
</style>

<div class="container py-5 profile-container">
    <div class="row justify-content-center">
        <div class="col-11 col-sm-10 col-md-8 col-lg-6 col-xl-5">

            <div class="text-center mb-4">
                <div class="position-relative d-inline-block">
                    <img src="https://ui-avatars.com/api/?name=@Model.Username&background=0D6EFD&color=fff&size=128"
                         class="rounded-circle shadow-lg avatar-border"
                         width="100" height="100" />
                    <span class="position-absolute bottom-0 end-0 bg-success border border-2 border-white rounded-circle" 
                          style="width: 22px; height: 22px;" title="Online"></span>
                </div>
                <h3 class="fw-bold mt-3" style="color: var(--text-main); letter-spacing: -0.02em;">@Model.Username</h3>
                <p class="text-muted small">Active Member since @DateTime.Now.ToString("MMMM yyyy")</p>
            </div>

            <div class="card profile-card border-0 shadow-lg p-2">
                <div class="card-body p-4 p-md-5">
                    
                    <div class="mb-4">
                        <h5 class="fw-bold m-0" style="color: var(--text-main);">Account Settings</h5>
                        <p class="text-muted small">Manage your identity and team association</p>
                    </div>

                    <form asp-action="Index" method="post" id="profileForm">
                        @Html.AntiForgeryToken()

                        @if (!ViewData.ModelState.IsValid)
                        {
                            <div asp-validation-summary="ModelOnly" class="alert alert-danger border-0 small rounded-3 mb-4"></div>
                        }

                        <div class="mb-3">
                            <label class="form-label-caps mb-2">Username</label>
                            <div class="input-group theme-input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                                <input asp-for="Username" class="form-control py-2" placeholder="Your username" />
                            </div>
                            <span asp-validation-for="Username" class="text-danger x-small"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label-caps mb-2">Email Address</label>
                            <div class="input-group theme-input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-envelope"></i>
                                </span>
                                <input asp-for="Email" class="form-control py-2" placeholder="you@email.com" />
                            </div>
                            <span asp-validation-for="Email" class="text-danger x-small"></span>
                        </div>

                        <div class="mb-4">
                            <label class="form-label-caps mb-2">Team Assignment</label>
                            <div class="input-group theme-input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-people"></i>
                                </span>
                                <select asp-for="TeamId" class="form-select py-2" asp-items="teamSelectList">
                                    <option value="">— No Team —</option>
                                </select>
                            </div>
                            @if (Model.TeamName != null)
                            {
                                <div class="x-small text-success mt-2 fw-medium">
                                    <i class="bi bi-shield-check me-1"></i> Verified member of <strong>@Model.TeamName</strong>
                                </div>
                            }
                        </div>

                        <button type="submit" id="saveBtn" class="btn btn-primary w-100 py-3 fw-bold shadow-sm" 
                                style="border-radius: 14px; transition: transform 0.2s;">
                            Update Profile
                        </button>
                    </form>

                    <hr class="my-5 opacity-10">

                    <div class="mb-4">
                        <h6 class="fw-bold m-0" style="color: var(--text-main);">Display Preference</h6>
                        <p class="text-muted small">Choose how TaskFlow Pro looks to you</p>
                        
                        <div class="d-flex gap-2">
                             <button type="button" class="btn btn-sm flex-fill rounded-3 border-0 py-2" 
                                     style="background: var(--nav-hover); color: var(--text-main);" onclick="setTheme('Light')">
                                 <i class="bi bi-sun me-1"></i> Light
                             </button>
                             <button type="button" class="btn btn-sm flex-fill rounded-3 border-0 py-2" 
                                     style="background: var(--nav-hover); color: var(--text-main);" onclick="setTheme('Dark')">
                                 <i class="bi bi-moon-stars me-1"></i> Dark
                             </button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="text-center mt-4">
                <a asp-action="Index" asp-controller="Task" class="small text-muted text-decoration-none fw-semibold">
                    <i class="bi bi-arrow-left-short fs-5 align-middle"></i> Back to Dashboard
                </a>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById('profileForm').addEventListener('submit', function() {
            if ($(this).valid()) {
                const btn = document.getElementById('saveBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Updating...';
            }
        });

        // Simple theme setter for the profile page
        function setTheme(themeName) {
            document.cookie = "tf_theme=" + themeName + ";path=/;max-age=" + (60 * 60 * 24 * 365);
            window.location.reload();
        }
    </script>
}