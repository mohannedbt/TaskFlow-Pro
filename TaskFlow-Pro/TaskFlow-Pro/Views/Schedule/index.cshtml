@{
    ViewData["Title"] = "Schedule";
}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />

<div class="d-flex flex-wrap justify-content-between align-items-center mb-5 gap-3">
    <div>
        <h3 class="fw-bold mb-1" style="color: var(--text-main);">Team Schedule</h3>
        <p class="text-muted small mb-0">
            <i class="bi bi-info-circle me-1"></i> Visualize project timelines and team availability
        </p>
    </div>

    <div class="d-flex gap-2">
        <button id="toggleCompact" class="btn btn-outline-secondary rounded-3 px-3">
            <i class="bi bi-distribute-vertical me-2"></i>Compact
        </button>
        <a asp-controller="Task" asp-action="Create" class="btn btn-primary rounded-3 fw-bold px-4 shadow-sm">
            <i class="bi bi-plus-lg me-1"></i> New Task
        </a>
    </div>
</div>

<div class="card border-0 shadow-lg p-2" style="border-radius: 24px; background-color: var(--card-bg);">
    <div class="card-body p-4">
        <div id="calendar"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    let compactMode = false;

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek,listWeek'
        },
        buttonText: {
            today: 'Today', month: 'Month', week: 'Week', list: 'Agenda'
        },
        events: '/Schedule/GetEvents',
        allDaySlot: true,
        displayEventTime: false,
        dayMaxEvents: 4,
        
        eventClick: function (info) {
            window.location.href = '/Task/Details/' + info.event.id;
        }
    });

    calendar.render();

    document.getElementById('toggleCompact').addEventListener('click', function() {
        compactMode = !compactMode;
        calendarEl.classList.toggle('compact-view', compactMode);
    });
});
</script>

<style>
    /* ===== DYNAMIC THEME OVERRIDES ===== */
    #calendar {
        font-family: 'Inter', system-ui, sans-serif;
        /* Calendar borders now follow your theme's border color */
        --fc-border-color: var(--sidebar-border);
        --fc-today-bg-color: var(--nav-hover);
        
        /* Button colors follow theme variables */
        --fc-button-bg-color: var(--bg-sidebar);
        --fc-button-border-color: var(--sidebar-border);
        --fc-button-text-color: var(--text-main);
        --fc-button-hover-bg-color: var(--nav-hover);
        --fc-button-hover-border-color: var(--sidebar-border);
        --fc-button-active-bg-color: var(--accent-primary);
        --fc-button-active-border-color: var(--accent-primary);
    }

    /* Fix Title color for Dark Mode */
    .fc .fc-toolbar-title {
        font-weight: 800;
        font-size: 1.4rem;
        color: var(--text-main);
        letter-spacing: -0.02em;
    }

    /* Day Numbers */
    .fc .fc-daygrid-day-number {
        font-weight: 700;
        color: var(--text-muted);
    }

    /* Active/Today state */
    .fc .fc-day-today .fc-daygrid-day-number {
        color: #fff;
        background: var(--accent-primary);
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
    }

    /* Event Styling Overrides for Dark Mode Readability */
    .fc-event {
        border: none !important;
        padding: 4px 8px !important;
        border-radius: 6px !important;
        font-weight: 600 !important;
    }

    /* Transparent backgrounds so they don't look muddy in dark mode */
    [data-theme="Dark"] .fc-event-ongoing { background: rgba(67, 56, 202, 0.25) !important; color: #818cf8 !important; border-left: 3px solid #818cf8 !important; }
    [data-theme="Dark"] .fc-event-completed { background: rgba(21, 128, 61, 0.25) !important; color: #4ade80 !important; border-left: 3px solid #4ade80 !important; }

    /* Fix Agenda/List view text for dark mode */
    .fc-list-event-title, .fc-list-day-text, .fc-list-day-side-text {
        color: var(--text-main) !important;
    }
    .fc-list-empty {
        background: var(--bg-body) !important;
        color: var(--text-muted) !important;
    }
</style>